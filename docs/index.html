<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axiom - A Decentralized Knowledge Network</title>
    <style>
        /* A simple, clean, modern stylesheet */
        :root {
            --background-color: #121212;
            --text-color: #EAEAEA;
            --primary-color: #00BFFF; /* Deep Sky Blue */
            --secondary-color: #333333;
            --card-color: #1E1E1E;
            --success-color: #2E7D32;
            --error-color: #C62828;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 90%;
            margin: 2rem auto;
            padding: 1rem;
        }
        header {
            text-align: center;
            padding: 4rem 1rem;
            border-bottom: 1px solid var(--secondary-color);
        }
        header h1 {
            font-size: 3.5rem;
            color: var(--text-color);
            margin: 0;
        }
        header h1 span {
            color: var(--primary-color);
        }
        header p {
            font-size: 1.2rem;
            color: #AAAAAA;
        }
        section {
            padding: 3rem 0;
            border-bottom: 1px solid var(--secondary-color);
        }
        h2 {
            font-size: 2.5rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 2rem;
        }
        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .card h3 {
            margin-top: 0;
            font-size: 1.8rem;
        }
        .button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--background-color);
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.2s ease;
            text-align: center;
        }
        .button:hover {
            transform: scale(1.05);
        }
        .button.secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .button.secondary:hover {
            background-color: var(--primary-color);
            color: var(--background-color);
        }

        /* --- NEW STYLES FOR THE WEB CLIENT --- */
        #axiom-client-container {
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            padding: 2rem;
            background-color: var(--card-color);
        }
        #query-input {
            width: 100%;
            padding: 14px;
            font-size: 1.1rem;
            border-radius: 5px;
            border: 1px solid var(--secondary-color);
            background-color: #2c2c2c;
            color: var(--text-color);
            box-sizing: border-box; /* Important */
            margin-bottom: 1rem;
        }
        #search-button {
            width: 100%;
            padding: 14px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #results-output {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: #121212;
            border-radius: 5px;
            min-height: 100px;
            border: 1px solid var(--secondary-color);
        }
        #results-output h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        #client-status-bar {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
            color: #888;
        }
        .status-light {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: var(--error-color); /* Default to red */
        }
        .status-light.connected {
            background-color: var(--success-color);
        }

        .download-grid, .community-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        footer {
            text-align: center;
            padding: 2rem;
            font-size: 0.9rem;
            color: #777777;
        }
    </style>
</head>
<body>

    <div class="container">

        <header>
            <h1>Axiom<span>.</span></h1>
            <p>A Decentralized Network for Verifiable Truth.</p>
        </header>

        <main>
            <!-- ============================================= -->
            <!-- === NEW: AXIOM LIVE WEB CLIENT SECTION === -->
            <!-- ============================================= -->
            <section id="try-live">
                <h2>Try Axiom Live</h2>
                <div id="axiom-client-container">
                    <input type="text" id="query-input" placeholder="Ask a question..." autocomplete="off">
                    <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                        <button id="search-button" class="button" style="flex: 1;">Search the Ledger</button>
                        <button id="think-toggle" class="button secondary" style="flex: 0 0 auto;">ðŸ¤” Think (LLM)</button>
                    </div>
                    <div id="results-output">
                        <!-- Results will be displayed here -->
                        <p>Your results will appear here. The client is currently attempting to connect to a live node.</p>
                    </div>
                    <div id="client-status-bar">
                        <span id="status-light" class="status-light"></span>
                        <span id="status-text">Disconnected</span>
                    </div>
                </div>
            </section>

            <!-- The Mission Section -->
            <section id="mission">
                <h2>The Mission</h2>
                <div class="card">
                    <h3>Rebuilding Reality's Bedrock.</h3>
                    <p>In an age of misinformation and digital noise, shared truth is decaying. Axiom is a new kind of networkâ€”an autonomous, decentralized organism designed to discover, verify, and preserve objective knowledge.</p>
                    <a href="#" class="button secondary">Read the Whitepaper &rarr;</a>
                </div>
            </section>

            <!-- Download Client Section -->
            <section id="download">
                <h2>Get the Axiom Client</h2>
                <div class="card">
                    <h3>Access the Network.</h3>
                    <p>The Axiom Client is your secure, private gateway to the network's collective intelligence. Download the desktop application for the full experience.</p>
                    <div class="download-grid">
                        <a href="#" class="button">Download for macOS</a>
                        <a href="#" class="button">Download for Windows</a>
                        <a href="#" class="button">Download for Linux</a>
                    </div>
                </div>
            </section>

            <!-- Run a Node Section -->
            <section id="run-a-node">
                <h2>Become a Guardian of Truth</h2>
                <div class="card">
                    <h3>Run a Node. Strengthen the Network.</h3>
                    <p>Axiom is powered by a global community of independent node operators. By running a node, you contribute to a free and permanent public record of truth.</p>
                    <a href="#" class="button secondary">View on GitHub &rarr;</a>
                </div>
            </section>

        </main>

        <footer>
            <p>The Axiom Protocol is free, open-source software gifted to the world.</p>
            <p>&copy; 2025 The Axiom Contributors. All rights reserved under the PPL.</p>
        </footer>

    </div>

    <!-- ============================================= -->
    <!-- === NEW: JAVASCRIPT LOGIC FOR WEB CLIENT === -->
    <!-- ============================================= -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- CONFIGURATION ---
            const AXIOM_NODE_URL = 'https://d089f71ab6a5.ngrok-free.app'; // Remember to update this with your ngrok URL!

            // --- UI ELEMENTS ---
            const queryInput = document.getElementById('query-input');
            const searchButton = document.getElementById('search-button');
            const thinkToggle = document.getElementById('think-toggle');
            const resultsOutput = document.getElementById('results-output');
            const statusLight = document.getElementById('status-light');
            const statusText = document.getElementById('status-text');

            // --- STATE ---
            let useLLM = true; // Default to LLM mode

            // --- CORE FUNCTIONS ---

            const checkNodeStatus = async () => {
                try {
                    const response = await fetch(`${AXIOM_NODE_URL}/status`, {
                        headers: { 'ngrok-skip-browser-warning': 'true' }
                    });

                    if (!response.ok) throw new Error('Network response was not ok.');

                    const data = await response.json();
                    statusLight.classList.add('connected');
                    statusText.textContent = `Connected | Block: ${data.latest_block_height} | Node: v${data.version}`;
                } catch (error) {
                    statusLight.classList.remove('connected');
                    statusText.textContent = `Error: Could not connect to node at ${AXIOM_NODE_URL}`;
                    console.error('Status check failed:', error);
                }
            };

            const toggleThinkMode = () => {
                useLLM = !useLLM;
                if (useLLM) {
                    thinkToggle.textContent = 'ðŸ¤” Think (LLM)';
                    thinkToggle.style.backgroundColor = 'var(--primary-color)';
                    thinkToggle.style.color = 'var(--background-color)';
                } else {
                    thinkToggle.textContent = 'âš¡ Fast (NLI)';
                    thinkToggle.style.backgroundColor = '#FF9800';
                    thinkToggle.style.color = 'white';
                }
            };

            const performSearch = async () => {
                const query = queryInput.value.trim();
                if (!query) return;

                searchButton.disabled = true;
                searchButton.textContent = 'Searching...';
                const modeText = useLLM ? 'with LLM synthesis' : 'fast mode (NLI only)';
                resultsOutput.innerHTML = `<p>Querying the network (${modeText})...</p>`;

                try {
                    const response = await fetch(`${AXIOM_NODE_URL}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'ngrok-skip-browser-warning': 'true'
                        },
                        body: JSON.stringify({ 
                            query: query,
                            use_llm: useLLM
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }

                    const data = await response.json();
                    displayResults(data);

                } catch (error) {
                    resultsOutput.innerHTML = `<h4>Error</h4><p>Could not perform search. Please ensure the Axiom node is running and accessible.</p><p><em>${error.message}</em></p>`;
                    console.error('Search failed:', error);
                } finally {
                    searchButton.disabled = false;
                    searchButton.textContent = 'Search the Ledger';
                }
            };

            // --- CAREFULLY ENHANCED displayResults FUNCTION ---
            const displayResults = (data) => {
                // Check if we have a synthesized answer from the secure RAG system
                if (data.answer) {
                    let resultsHtml = `<h4>Direct Answer</h4>`;
                    resultsHtml += `<div style="background-color: #1a1a1a; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color); margin-bottom: 1.5rem;">`;
                    resultsHtml += `<p style="font-size: 1.1rem; line-height: 1.6; margin: 0;">${data.answer}</p>`;
                    resultsHtml += `</div>`;
                    
                    // Add synthesis status if available
                    if (data.synthesis_status) {
                        const statusColor = data.synthesis_status === 'success' ? 'var(--success-color)' : 'var(--error-color)';
                        resultsHtml += `<p style="font-size: 0.8rem; color: ${statusColor}; margin-bottom: 1rem;">`;
                        resultsHtml += `<strong>Synthesis Status:</strong> ${data.synthesis_status} - ${data.message || ''}`;
                        resultsHtml += `</p>`;
                    }
                    
                    // Show supporting facts if available
                    if (data.results && data.results.length > 0) {
                        resultsHtml += `<h4>Supporting Facts from Axiom Ledger</h4>`;
                        resultsHtml += `<p style="font-size: 0.9rem; color: #aaa; margin-bottom: 1rem;">`;
                        resultsHtml += `The answer above is based on these verified facts from the Axiom network:`;
                        resultsHtml += `</p>`;
                        
                        const topResults = data.results.slice(0, 3);
                        resultsHtml += topResults.map((result, index) => {
                            const content = result.content || '[Content not available]';
                            const similarity = result.similarity * 100;
                            const sourceDomain = (result.sources && result.sources.length > 0) ? result.sources[0] : 'Unknown Source';
                            const sanitizedContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                            
                            const separator = index > 0 ? '<hr style="border-color: var(--secondary-color); margin: 1em 0;">' : '';
                            const linkUrl = result.source_url ? result.source_url : `https://${sourceDomain}`;
                            
                            let sourceHtml;
                            if (sourceDomain !== 'Unknown Source') {
                                sourceHtml = `<a href="${linkUrl}" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">${sourceDomain}</a>`;
                            } else {
                                sourceHtml = sourceDomain;
                            }
                            
                            return `
                                ${separator}
                                <div style="background-color: #2a2a2a; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                                    <p style="font-size: 0.9rem; color: #ccc; margin: 0 0 0.5rem 0;"><strong>Relevance:</strong> ${similarity.toFixed(1)}%</p>
                                    <blockquote style="margin: 0; padding-left: 1rem; border-left: 3px solid var(--secondary-color); font-style: italic; font-size: 0.9rem;">
                                        "${sanitizedContent}"
                                    </blockquote>
                                    <p style="font-size: 0.8rem; color: #888; margin: 0.5rem 0 0 0;"><strong>Source:</strong> ${sourceHtml}</p>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    resultsOutput.innerHTML = resultsHtml;
                    return;
                }
                
                // Handle fast mode (LLM disabled)
                if (data.synthesis_status === 'disabled') {
                    let resultsHtml = `<h4>Fast Mode Results</h4>`;
                    resultsHtml += `<p style="font-size: 0.9rem; color: #aaa; margin-bottom: 1rem;">`;
                    resultsHtml += `ðŸ¤” <strong>Think mode is OFF</strong> - Showing raw facts from the ledger without LLM synthesis for faster response times.</p>`;
                    
                    if (data.results && data.results.length > 0) {
                        resultsHtml += `<h4>Relevant Facts from Axiom Ledger</h4>`;
                        
                        const topResults = data.results.slice(0, 5);
                        resultsHtml += topResults.map((result, index) => {
                            const content = result.content || '[Content not available]';
                            const similarity = result.similarity * 100;
                            const sourceDomain = (result.sources && result.sources.length > 0) ? result.sources[0] : 'Unknown Source';
                            const sanitizedContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                            const isDisputed = result.disputed || false;
                            
                            const separator = index > 0 ? '<hr style="border-color: var(--secondary-color); margin: 1em 0;">' : '';
                            const linkUrl = result.source_url ? result.source_url : `https://${sourceDomain}`;
                            const disputeStyle = isDisputed ? 'border-left-color: #ff4444;' : 'border-left-color: #4CAF50;';
                            const disputeText = isDisputed ? ' (DISPUTED)' : '';
                            
                            let sourceHtml;
                            if (sourceDomain !== 'Unknown Source') {
                                sourceHtml = `<a href="${linkUrl}" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">${sourceDomain}</a>`;
                            } else {
                                sourceHtml = sourceDomain;
                            }
                            
                            return `
                                ${separator}
                                <div style="background-color: #2a2a2a; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                                    <p style="font-size: 0.9rem; color: #ccc; margin: 0 0 0.5rem 0;"><strong>Relevance:</strong> ${similarity.toFixed(1)}%${disputeText}</p>
                                    <blockquote style="margin: 0; padding-left: 1rem; border-left: 3px solid; font-style: italic; font-size: 0.9rem; ${disputeStyle}">
                                        "${sanitizedContent}"
                                    </blockquote>
                                    <p style="font-size: 0.8rem; color: #888; margin: 0.5rem 0 0 0;"><strong>Source:</strong> ${sourceHtml}</p>
                                </div>
                            `;
                        }).join('');
                    } else {
                        resultsHtml += `<p>No relevant facts found in the ledger.</p>`;
                    }
                    
                    resultsOutput.innerHTML = resultsHtml;
                    return;
                }
                
                // Fallback to old format if no synthesized answer
                const results = data.results || data;
                if (!results || results.length === 0) {
                    resultsOutput.innerHTML = '<h4>No Relevant Facts Found</h4><p>The network searched the ledger but could not find a fact that semantically matched your question.</p>';
                    return;
                }
                
                results.sort((a, b) => b.similarity - a.similarity);
                const topResults = results.slice(0, 3);

                let resultsHtml = topResults.map((result, index) => {
                    const content = result.content || '[Content not available]';
                    const similarity = result.similarity * 100;

                    let title = '';
                    let explanation = '';

                    if (similarity > 85) {
                        title = `Direct Answer Found (${similarity.toFixed(1)}% Match)`;
                        explanation = `The following fact is a high-confidence semantic match to your question:`;
                    } else if (similarity > 65) {
                        title = `Related Fact Found (${similarity.toFixed(1)}% Match)`;
                        explanation = `While not a direct answer, the following fact from the ledger is highly related to your query:`;
                    } else {
                        title = `Possible Hint Found (${similarity.toFixed(1)}% Match)`;
                        explanation = `I'm not very sure, but this is the most related information I could find in the ledger:`;
                    }

                    const sourceDomain = (result.sources && result.sources.length > 0) ? result.sources[0] : 'Unknown Source';
                    const sanitizedContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    const separator = index > 0 ? '<hr style="border-color: var(--secondary-color); margin: 2em 0;">' : '';
                    const linkUrl = result.source_url ? result.source_url : `https://${sourceDomain}`;
                    
                    let sourceHtml;
                    if (sourceDomain !== 'Unknown Source') {
                        sourceHtml = `<a href="${linkUrl}" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">${sourceDomain}</a>`;
                    } else {
                        sourceHtml = sourceDomain;
                    }

                    return `
                        ${separator}
                        <h4>${title}</h4>
                        <p><em>${explanation}</em></p>
                        <blockquote style="margin-left: 0; padding-left: 1em; border-left: 3px solid var(--secondary-color); font-style: italic;">
                           "${sanitizedContent}"
                        </blockquote>
                        <p style="font-size: 0.9em; color: #aaa;"><strong>Source:</strong> ${sourceHtml}</p> 
                    `;
                }).join('');

                resultsOutput.innerHTML = resultsHtml;
            };

            // --- EVENT LISTENERS ---
            searchButton.addEventListener('click', performSearch);
            thinkToggle.addEventListener('click', toggleThinkMode);
            queryInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });

            // --- INITIALIZATION ---
            // Initialize toggle button styling
            thinkToggle.style.backgroundColor = 'var(--primary-color)';
            thinkToggle.style.color = 'var(--background-color)';
            
            checkNodeStatus(); // Check status on page load
            setInterval(checkNodeStatus, 60000); // And check every 60 seconds
        });
    </script>
</body>
</html>
